<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Python Playground</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.26.2/full/pyodide.js"></script>

  <!-- CodeMirror 5 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>

  <style>
    html, body {
      margin: 0; height: 100%; overflow: hidden;
      background: #0f172a; color: #e5e7eb;
      font-family: system-ui, sans-serif;
    }
    header {
      height: 48px; display:flex; align-items:center; justify-content:center;
      background:#111827; position:relative;
    }
    .version {
      position:absolute; left:8px; top:8px;
      font-size:12px; background:#1f2937; color:#a3e635;
      padding:4px 6px; border-radius:6px; font-weight:700;
    }
    main {
      display:flex; height: calc(100% - 48px); gap:8px; padding:8px;
      box-sizing:border-box;
    }
    .panel {
      flex:1; display:flex; flex-direction:column; border-radius:6px;
      background:#1e293b; overflow:hidden;
    }
    .panel .title {
      padding:6px 10px; background:#0f172a; font-weight:600;
      display:flex; justify-content:space-between; align-items:center;
    }
    .panel .body { flex:1; overflow:auto; }
    /* CodeMirror fill panel */
    .CodeMirror { height:100% !important; font-size:16px; }
    pre { margin:0; font-family:monospace; white-space:pre-wrap; }
    .stdout { color:#4ade80; }
    .stderr { color:#f87171; }
    .status { color:#60a5fa; }
  </style>
</head>
<body>
  <header>
    <div class="version" id="version"></div>
    <h1>Python Playground</h1>
  </header>

  <main>
    <!-- Editor -->
    <section class="panel">
      <div class="title">
        <span>Editor</span>
        <div class="flex gap-2">
          <button id="runBtn" class="bg-green-500 text-black px-2 py-1 rounded">Run â–¶</button>
          <button id="clearBtn" class="bg-red-500 text-black px-2 py-1 rounded">Clear</button>
        </div>
      </div>
      <div class="body">
        <textarea id="editor">print("Hello, World!")</textarea>
      </div>
    </section>

    <!-- Output -->
    <section class="panel">
      <div class="title">Console</div>
      <div class="body">
        <pre id="output"></pre>
      </div>
    </section>
  </main>

  <script>
    // Random version
    document.getElementById("version").textContent =
      "v" + Math.floor(Math.random()*10) + "." + Math.floor(Math.random()*10) + "." + Math.floor(Math.random()*100);

    // CodeMirror 5 init
    const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
      mode: "python",
      lineNumbers: true,
      theme: "dracula",
    });

    const outputEl = document.getElementById("output");
    const runBtn = document.getElementById("runBtn");
    const clearBtn = document.getElementById("clearBtn");

    let pyodideReady = false, pyodideInstance;

    async function loadPy() {
      outputEl.innerHTML = "<span class='status'>Loading Python...</span>";
      pyodideInstance = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.26.2/full/" });
      pyodideReady = true;
      outputEl.innerHTML = "<span class='status'>Python ready!</span>";
    }
    loadPy();

    runBtn.onclick = async () => {
      if (!pyodideReady) return;
      outputEl.innerHTML = "<span class='status'>Running...</span>\n";
      try {
        const code = editor.getValue();
        let logs = [];
        pyodideInstance.stdout = (msg) => logs.push("<span class='stdout'>" + msg + "</span>");
        pyodideInstance.stderr = (msg) => logs.push("<span class='stderr'>" + msg + "</span>");
        await pyodideInstance.runPythonAsync(code);
        outputEl.innerHTML = logs.join("\n") || "<span class='status'>(no output)</span>";
      } catch (err) {
        outputEl.innerHTML = "<span class='stderr'>Error: " + err + "</span>";
      }
    };

    clearBtn.onclick = () => { outputEl.innerHTML = ""; };
  </script>
</body>
</html>
